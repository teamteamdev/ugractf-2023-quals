# Сельский блог: Write-up

Переходя по ссылке, мы встречаем сайт с явно солидной историей — не изменив своему дизайну из 2007 года, он вобрал в себя все лучшие достижения современных веб-технологий последнего десятилетия.

Закрываем cookie-баннер, ждём загрузки страницы, и наконец можем приступить к изучению контента веб-сайта. А, нет, перед этим нужно ещё не забыть выключить радио Парижа (а лучше — сразу звук на компьютере).

На сайте есть несколько заметок. Однако полностью нам удаётся прочитать только одну — про будущее издания. В ней главный редактор рассказывает о том, что все статьи теперь платные. И, действительно, на всех остальных страницах нам предлагают купить подписку для дальнейшего чтения. Сама подписка стоит 1 ETH — такие деньги тратить мы не готовы. Да и в качестве подтверждения оплаты нас просят прислать приватный ключ кошелька, что также является не лучшей идеей. Попробуем получить доступ к контенту другим образом.

У задания есть несколько способов его решить: не обязательно было делать все действия из райтапа, любой из вариантов привёл бы к флагу.

Давайте вообще узнаем, как устроен этот пейволл. Мы видим, что вместо продолжения статьи сайт показывает белый блок с предложением оплатить подписку, а при попытке проскроллить — выдаёт баннер и почему-то блокирует возможность прокрутки страницы.

Откроем инструменты разработчика и посмотрим на этот блок. Сразу замечаем, что на `<body>` добавляется два свойства — `overflow: hidden; height: 100%;`. Судя по всему, они и блокируют прокрутку. Если их убрать, то всплывающее окно нас больше не беспокоит.

Но самое интересное начинается под блоком со спойлером. Мы видим там [некий скрипт](app/villageblog/static/js/paywall.js) с говорящим названием `paywall.js`. Давайте изучим его.

Видим, что при загрузке документа скрипт делает запрос на `/{base_url}/tr/{postid}`. Но что это за переменные? Ответ быстро становится понятен, если заглянуть в код страницы — там мы найдём два инлайновых скрипта. `{base_url}` содержит наш токен — уникальный хешик в начале ссылки, а `{postid}` — некая уникальная строка, которая подставляется в каждый пост.

Обновим страницу и поищем этот запрос на вкладке Network. В ответе возвращается одно поле `data` с base64-строкой. Если её декодировать, то мы получим код на HTML — приглядевшись, понимаем, что это и есть та самая статья.

Это же содержимое мы можем найти в инструментах разработчика в блоке с классом `.pw` — прямо над скриптом.

Давайте попробуем обмануть сайт и всё же отобразить статью целиком, чтобы читать рецепты картошечки было ещё удобнее. Для этого сначала просто удалим в инспекторе блок со спойлером `.spoiler-wr` целиком отлично подойдёт.

После этого на месте ожидаемого текста мы видим размытое пятно. Его причина — буквально одной строкой ниже — на блоке `.pw` применён фильтр: `filter: blur(1.5rem)`. Убираем и этот стиль — но это помогает ненадолго. Что-то возвращает его назад — по всей видимости, код на Javascript. Тут можно поступить двумя способами: либо отключить исполнение JS на вкладке Debugger, либо обратиться к `paywall.js` и найти код, отвечающий за блюр. Он каждую секунду применяет блюр к элементу `.pw`. Давайте просто удалим этот класс: нет элемента — нет проблемы. После удаления класса и стилей проблема исчезает.

Читаем рецепт картошечки и советы по выращиванию перца, а в статье о нашей олимпиаде находим флаг в рецепте хорошего пентеста.

*Изображения: unsplash.com, Mockup Graphics, пользователи Gilles DETOT, Egidijus Bielskis, Martin Adams, Markus Spiske, christian buehner, Jefferson Santos, Onur Binay, Tengyart.*

Флаг: **ugra_please_dont_read_it_you_didnt_pay_c4ytfrpdhq8n**
